<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Imobili√°rio - Login</title>
    <script type="text/javascript" src="https://ff.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=kW0-uZ7KXNUoFJ4TI7SJyn4Pg-NHPXFr0JlSvJ5_2a-86UnfOD0WtNw50MJMMZX_dFNV6uXh7YEfmE_BI_Xu3zCXKbLXYFz2xrfuUuMmE0fYJHXkunXCeLb9MyAPdvCb3Ms8n_DB04yQMOJVK0yfdeLjECZdHkwA3r9t1WtjbaR39piYkPWMt3THnDUJvOMrvGln2Cjy1yMdyujs9PjPyXxIMQ4APKJ-8SYBQtNnw4fxcsTvZYw-hdJAuu2lP1hvhDOs5kKwBoR4MEhc33KpXO3lGaTONHrBDRIC4tuJfUemUrZNdY9UskG-Ncf7Y7F8Z3iT2qJALXx7T_mS7wTA4gHl0XbJvKrde5tKKcDOIgmuZf5y07xp_837ZO_Xv28u8gcvSslx_r4Enm1t34ADc-0etDEQFxrL_UdazB-1r2r0_LknnrX0646_O0kS8VvkJ-x5y6qv2tUsQB3PMHFPAJL8IBA4HAGbfyP5bLKfSCmip-QqpewqWarXhBTeCOGJ31kJ7yQcFKh3zOOrc64IB1Ap7z1PazmRpD_3gyyjIOTKLc9IBsSCLA77ohCYYAVwGRbojvWeWqVBJXQ0FuRWvmgcK8wy8W41REhVE9a9KPLoSnlg7JjY74YQIbwKSHg2m15bOTDIh_T8weFd_Eu2nWtXUMY_8gtCa0veUCm-srKXgih7P0r6A0G1exzcYYHgL_GKh5dLqNbizpauMVxIbwn53niSDRVnnv-6w6JFJBKF9uO2qTg9rhwnpqzsxtB3Z-rzsMlg_eJuuKVJcNvJFudTnI44OyLSwup4FQJc-HYEvKrze1lqnimTyuReSUI6qCGbRe-GfregOKdp-CJZzohM5PoQX5wqNZhkAbCveNRjGlmO51HbAF6MRd38GESA8eDQnsFrenfy_x8vfOErcE8z9gu0Yjy9GQe5aUytAaaTx-CfWNbGSyS5J-Gfo6Bh99biyz1BlFxbfsbyXAFoX1QbU2v6D_iO1oILDbZouQ11ARmazuIrsl8JrEURK7uUw0U5-JNR5VclczKwprrV6IUlkpIEyqviA7N4EgMyhOkyrCl3nobAyRGYzt5cuzJuCgtCjPYUSGwIB8wVDO5_V6fFTKgVtJtmSD_5KsrGkQ2TT2dO171hQePTfjVixsSB5iQeknb_zPlVhzpC-4IzU6Y1Syh0Gxr7E5MnEvjqDBo0d3lZ0r1mRXwR6lJ_129NFllzUkhXXIGXF7IHuRPb0a_I7UvW8b9IIdhCYEXB6hM7FXn-S-2jaNcOwookfWgh4DpXJLe72vFjjffvYqwd2PUPsg2GmYA9UBQYzHXCa01NlQ2OQRcE6zqzXpx3RUm6eP27kBxJ0sx78U6QLnXLGUKdf01rwKz3WLb3gQOyxtcN6rYsM3Q6_RP5_Mq1lh7CTAr_rdAjRPKmB0UlcLOkG0bWex7gjOt3XJqr4JCKHu5vvJoqGrNvEw8a_DTGe3FjNasYwNNnhrm_RGoeJMgjNYoDEPxJCp5VVzD7LrKDSPPm3pBLLJcWIuZaIlxq0S4N4Pu_Mtr5NRPSMn42td_KxTm6Q8a3jXMY1RQuOnNRCB8fOtbF5mEFh1_tnK7etnqfhAmkOAtPViupq-I2pD-OlnZXTyP8mb0dU_THf7vrZL0nYItBbA0dIEK_jalaBuz_rldgUR6gY0dZ0BKKbocxLBQGD2fhnJmXZyQEVy11UFoKOi7Ymg6SiKTMIYPv792qHPJ8pZQhXSiRawI3NZj7ILc9L267gY6ysN2axk374i74OQGnpfbD-9jM04klbJZDTuJnAOllQXiIb4OkmC3mP0MOjITWR7w6s8l_7uT5AYm8oc3xegglt_f2ez1ARBeuAjXlQNvIaPqcAtkVFrIoYIdvJ3V4bWvANHdafKPtMPZasd_WGut0YSKI_wxkCLzY0vNWyr41ceXbpcSKA35ISaKlIg2uODkbsIcDKzC5Ll2nLFfrWeZ_Q-ceJVpM0GRE7v_Al2uIb4npg8VgEwTfCL8cuhbMrX7Za-w4Xk5o4xutZs0JrJWH_KpnL1uCA-XDIonh2Jsr0bhKmm95fYBztz4NTOr3nDaXo9RkI3t8CN_oUYOBfeV2nTVmlXbtliMB6DmDEaJZ0x7bLPn01Evs1rswOGlWcs1IYlibgLimzSP8l76zNo-ixDrcYtWtatx0Lof42pRUiSEFf-U3XjziWZD3t9c6Vsk9KtbcBiOAdInxqmIt2xvLgYZfBPCaM3wjP9nxU_cy6LpdUl2pqs5vMBLlvxiSZq_fPYlF6KAMduCVSA9L4dkiPPHntap-8h8j" charset="UTF-8"></script><style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 400px;
            max-width: 90vw;
        }
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #5a67d8;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .message {
            margin-top: 1rem;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            display: none;
        }
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .demo-info {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            color: #004085;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-size: 14px;
        }
        /* Dashboard oculto inicialmente */
        .dashboard {
            display: none;
        }
        .dashboard.active {
            display: block;
        }
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-header">
            <h1>üè† Sistema Imobili√°rio</h1>
            <p>Fa√ßa login para acessar o sistema</p>
        </div>

        <div class="demo-info">
            <strong>üîë Credenciais de demonstra√ß√£o:</strong><br>
            Email: admin@imobiliaria.com<br>
            Senha: password
        </div>

        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" value="admin@imobiliaria.com" required>
            </div>

            <div class="form-group">
                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha" value="password" required>
            </div>

            <button type="submit" class="btn" id="loginBtn">
                Entrar no Sistema
            </button>
        </form>

        <div id="message" class="message"></div>
    </div>

    <!-- Dashboard (oculto inicialmente) -->
    <div id="dashboard" class="dashboard">
        <button class="logout-btn" onclick="logout()">Sair</button>

        <div style="padding: 2rem; background: white; border-radius: 10px; margin: 2rem;">
            <h1>üéâ Login Realizado com Sucesso!</h1>
            <h2>üìä Dashboard do Sistema Imobili√°rio</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 2rem 0;">
                <div style="background: #e7f3ff; padding: 1rem; border-radius: 8px; text-align: center;">
                    <h3 style="color: #0056b3;">Im√≥veis</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #0056b3;" id="totalImoveis">0</p>
                </div>
                <div style="background: #d4edda; padding: 1rem; border-radius: 8px; text-align: center;">
                    <h3 style="color: #155724;">Dispon√≠veis</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #155724;" id="imoveisDisponiveis">0</p>
                </div>
                <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; text-align: center;">
                    <h3 style="color: #856404;">Contratos</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #856404;" id="contratos">0</p>
                </div>
                <div style="background: #f8d7da; padding: 1rem; border-radius: 8px; text-align: center;">
                    <h3 style="color: #721c24;">Faturas</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #721c24;" id="faturas">0</p>
                </div>
            </div>

            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                <h3>‚úÖ Sistema Funcionando Perfeitamente!</h3>
                <p><strong>Token JWT:</strong> <span id="tokenInfo">Carregando...</span></p>
                <p><strong>Usu√°rio:</strong> <span id="userInfo">Carregando...</span></p>
                <p><strong>Data/Hora:</strong> <span id="datetime"></span></p>
            </div>

            <div style="margin-top: 2rem; text-align: center;">
                <p style="color: #28a745; font-weight: bold; font-size: 1.2rem;">
                    üéâ Parab√©ns! Seu sistema est√° funcionando 100%!
                </p>
                <p>Agora voc√™ pode implementar as funcionalidades espec√≠ficas do seu neg√≥cio.</p>
            </div>
        </div>
    </div>

    <script>
        console.log('üé¨ Sistema Imobili√°rio - Frontend Simplificado Iniciado');

        // Vari√°veis globais
        let currentToken = null;
        let currentUser = null;

        // Fun√ß√£o para mostrar mensagens
        function showMessage(text, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';

            console.log(`üì¢ Mensagem (${type}): ${text}`);

            // Auto-hide ap√≥s 5 segundos
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Fun√ß√£o de login
        async function handleLogin(email, senha) {
            console.log(`üîê Tentando login: ${email}`);

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, senha })
                });

                console.log(`üì° Status da resposta: ${response.status}`);

                const data = await response.json();
                console.log('üì° Dados da resposta:', data);

                if (data.success && data.token) {
                    console.log('‚úÖ Login bem-sucedido!');

                    currentToken = data.token;
                    currentUser = data.user;

                    showMessage('Login realizado com sucesso!', 'success');

                    // Aguardar um pouco e mostrar dashboard
                    setTimeout(() => {
                        showDashboard();
                    }, 1000);

                } else {
                    throw new Error(data.message || 'Login falhou');
                }

            } catch (error) {
                console.error('‚ùå Erro no login:', error);
                showMessage(`Erro no login: ${error.message}`, 'error');
            }
        }

        // Fun√ß√£o para mostrar dashboard
        function showDashboard() {
            console.log('üè† Mostrando dashboard...');

            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');

            // Atualizar informa√ß√µes
            document.getElementById('tokenInfo').textContent = currentToken.substring(0, 50) + '...';
            document.getElementById('userInfo').textContent = currentUser.nome + ' (' + currentUser.email + ')';
            document.getElementById('datetime').textContent = new Date().toLocaleString();

            // Carregar estat√≠sticas
            loadStats();

            console.log('‚úÖ Dashboard exibido com sucesso');
        }

        // Fun√ß√£o para carregar estat√≠sticas
        async function loadStats() {
            console.log('üìä Carregando estat√≠sticas...');

            try {
                const response = await fetch('/api/dashboard/stats', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('üìä Estat√≠sticas carregadas:', data);

                    document.getElementById('totalImoveis').textContent = data.data.imoveis.total || 0;
                    document.getElementById('imoveisDisponiveis').textContent = data.data.imoveis.disponiveis || 0;
                    document.getElementById('contratos').textContent = data.data.contratos.ativos || 0;
                    document.getElementById('faturas').textContent = data.data.faturas.pendentes || 0;
                } else {
                    console.log('‚ö†Ô∏è  Estat√≠sticas n√£o dispon√≠veis, usando valores padr√£o');
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar estat√≠sticas:', error);
            }
        }

        // Fun√ß√£o de logout
        function logout() {
            console.log('üëã Fazendo logout...');

            currentToken = null;
            currentUser = null;

            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('loginScreen').style.display = 'block';

            showMessage('Logout realizado com sucesso!', 'success');

            console.log('‚úÖ Logout conclu√≠do');
        }

        // Event listener do formul√°rio
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('üìù Formul√°rio de login submetido');

            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            const loginBtn = document.getElementById('loginBtn');

            // Desabilitar bot√£o e mostrar loading
            loginBtn.disabled = true;
            loginBtn.textContent = 'Entrando...';

            try {
                await handleLogin(email, senha);
            } catch (error) {
                console.error('üí• Erro no processo de login:', error);
            } finally {
                // Restaurar bot√£o
                loginBtn.disabled = false;
                loginBtn.textContent = 'Entrar no Sistema';
            }
        });

        // Teste de conectividade inicial
        fetch('/api/health')
            .then(response => response.json())
            .then(data => {
                console.log('‚úÖ API Health Check OK:', data);
                showMessage('Sistema conectado e funcionando!', 'success');
            })
            .catch(error => {
                console.error('‚ùå API Health Check Falhou:', error);
                showMessage('Erro de conectividade com a API', 'error');
            });

        console.log('‚úÖ Frontend simplificado inicializado com sucesso');
    </script>
</body>
</html>